<!doctype html>

<html lang="en">

<head>
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-NX7VL0ZZMV"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-NX7VL0ZZMV');
    </script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
    <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">

    <meta property="og:title" content="Docker Nanoserver base image Windows">
<meta property="og:description" content="Building a docker image using nanoserver base">
<meta name="description" content="Building a docker image using nanoserver base">

<meta property="og:image" content="https://coolstercodes.com/content/images/docker-nanoserver-base-image-windows/docker.png">

<meta property="og:url" content="https://coolstercodes.com/docker-nanoserver-base-image-windows">
<link rel="canonical" href="https://coolstercodes.com/docker-nanoserver-base-image-windows">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2022-01-09T12:30:00Z">
<meta property="article:author" content="https://coolstercodes.com">

<meta property="article:tag" content="Development">

<meta property="article:tag" content="Docker">

<meta property="article:tag" content="Windows">


    <title>Docker Nanoserver base image Windows - Coolster Codes</title>

    <link rel="shortcut icon" type="image/png" href="/content/images/favicon.png">

    <link href="/content/stylesheets/tailwind.css" media="screen" rel="stylesheet" type="text/css">
<link href="/content/stylesheets/tailwind_custom.css" media="screen" rel="stylesheet" type="text/css">

<link href="/content/stylesheets/fancybox.css" media="screen" rel="stylesheet" type="text/css">


    

    <script src="/websocket.js" type="text/javascript"></script>
    
</head>

<body class="antialiased bg-[#222222] bg-no-repeat bg-gradient-to-br
min-h-screen">
    <div class="hidden h-16 md:flex">
        <div class="w-60">
            <a href="/">
                <img class="pl-2 pt-1 max-h-full max-w-full" src="/content/images/CoolsterCodes.png">
            </a>
        </div>
        <div class="w-10 flex flex-grow justify-evenly items-center">
            <ul class="flex">
                <li>
                    <a class="nav_item block mx-2 text-white"
                        href="/">Home</a>
                </li>
                <li>
                    <a class="nav_item block mx-2 text-white"
                        href="/about">About</a>
                </li>
                <li>
                    <a class="nav_item block mx-2 text-white"
                        href="/tags/">Tags</a>
                </li>
            </ul>
        </div>
        <div class="w-60 flex">
            <form role="search" id="search"
                class="flex items-center bg-gray-800 text-gray-400 border border-gray-600 rounded-lg px-3 py-2 w-80 m-3">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M21 21l-4.35-4.35m0 0A7.5 7.5 0 104.5 4.5a7.5 7.5 0 0012.15 12.15z" />
                </svg>
                <input id="search-query" type="search" placeholder="Search" autocomplete="off" aria-label="Search"
                    class="bg-transparent focus:outline-none w-full text-gray-200 placeholder-gray-400" />
            </form>
        </div>
</div>


<div class="flex h-16 md:hidden">
    <div class="w-40">
        <a href="/">
            <img class="pl-1 pt-1 max-h-full max-w-full" src="/content/images/CoolsterCodes.png">
        </a>
    </div>
    <div class="w-5 flex-grow"></div>
    <div class="w-40 flex justify-end items-center pr-3">
        <div class="hamburger" onclick="toggle(this)">
            <div class="bar1"></div>
            <div class="bar2"></div>
            <div class="bar3"></div>
        </div>
    </div>
</div>
<div class="hidden md:hidden" id="drop-down">
    <div class="h-14 w-full flex flex-col justify-evenly pl-5 pt-2 text-xl text-white mobile_nav" onclick="animate_blue(this)">
        <a href="/">Home</a>
    </div>
    <div class="h-14 w-full flex flex-col justify-evenly pl-5 text-xl text-white mobile_nav" onclick="animate_blue(this)">
        <a href="/about">About</a>
    </div>
    <div class="h-14 w-full flex flex-col justify-evenly pl-5 text-xl text-white mobile_nav" onclick="animate_blue(this)">
        <a href="/tags/">Tags</a>
    </div>
    <div class="h-14 w-full">
        <form role="search" id="search"
            class="flex items-center bg-gray-800 text-gray-400 border border-gray-600 rounded-lg px-3 py-2 m-3">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round"
                    d="M21 21l-4.35-4.35m0 0A7.5 7.5 0 104.5 4.5a7.5 7.5 0 0012.15 12.15z" />
            </svg>
            <input id="search-query-mobile" type="search" placeholder="Search" autocomplete="off" aria-label="Search"
                class="bg-transparent focus:outline-none w-full text-gray-200 placeholder-gray-400" />
        </form>
    </div>
</div>
<div id="main-div">
    <div class="mb-12 mt-0 px-4">
    <div class="container max-w-[950px] mx-auto">
        <h1 class="font-semibold font-sans leading-none my-8 text-center text-6xl text-white tracking-tighter md:font-normal md:text-8xl">
            Docker Nanoserver base image Windows
        </h1>
    </div>
</div>

<div class="container max-w-[900px] mx-auto mt-8 px-4 xl:max-w-[1125px]">
    <div class="md:flex">
        <div class="basis-[170px] flex-grow-0 flex-shrink-0 hidden md:block"> 
            <div class="leading-normal text-xs tracking-tighter sticky text-center text-white top-5">
                <div class="border-b px-4 pb-4 ">
                    <div class="font-bold mb-0.5 text-white">Article</div>
                    <div class="text-myblue">
                        <a class="hover:border-b-sky-600 hover:text-sky-600 underline" href="javascript:void(0)" onclick="copyText('https:\/\/coolstercodes.com/docker-nanoserver-base-image-windows')">
                            Docker Nanoserver base image Windows <span class="mx-0.5"><b class="copy text-myblue hover:border-b-sky-600 hover:text-sky-600 underline"></b></span>
                        </a>
                        <span
                            id="copyalert"
                            class="hidden tooltip absolute left-1/2 -translate-x-1/2 bg-gray-600 text-white text-xs px-2 py-1 rounded opacity-0 transition-opacity duration-300">
                            Copied!
                        </span>
                    </div>
                </div>

                
                <div class="border-b flex items-stretch text-center ">
                    <div class="border-r flex-grow ">
                        <div class="flex h-full items-center">
                            <div class="px-4 py-4">
                                <div class="font-bold mb-0.5 text-white">Author</div>
                                <div class="leading-tight text-myblue">
                                    <a class="hover:border-b-sky-600 hover:text-sky-600 underline"
                                        href="/about">Me</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="flex-grow h-full min-w-0">
                        <div class="flex items-center">
                            <div class="px-4 py-4">
                                <div class="font-bold mb-0.5 text-white">Published</div>
                                <div class="leading-tight">Jan 9, 2022</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="font-bold mb-0.5 text-white px-4 py-4">
                    <p class="mb-2">YouTube<br> <a class="hover:border-b-sky-600 hover:text-sky-600 font-bold text-myblue underline" href="https://youtu.be/1ad5dq0Wi-c" target="_blank">@coolstercodes</a></p>
                </div>
            </div>
        </div>

        <div class="pb-4 md:border-l md:flex-grow md:min-w-0 md:pl-8 xl:pr-8 ">
            

            <div class="hyphens-auto
                max-w-none
                prose prose-lg
                prose-a:font-sans
                prose-blockquote:text-slate-300
                prose-img:w-full prose-img:my-0
                prose-h2:text-xl prose-h2:mb-1 prose-a:prose-h2:border-b-0 prose-a:prose-h2:font-bold prose-h2:text-myblue prose-a:prose-h2:no-underline
                prose-h3:text-lg prose-h3:mb-1 prose-a:prose-h3:border-b-0 prose-a:prose-h3:font-bold prose-h3:text-myblue prose-a:prose-h3:no-underline
                prose-h4:text-base prose-h4:mb-1 prose-a:prose-h4:border-b-0 prose-a:prose-h4:font-bold prose-h4:text-myblue prose-a:prose-h4:no-underline
                prose-hr:my-10 prose-hr:md:-mx-[2rem] prose-hr:md:w-[calc(100%+4rem)]
                prose-p:font-serif
                text-[17px]
                prose-li:my-0
                prose-figcaption:mt-3
                prose-p:prose-blockquote:font-sans
                prose-pre:leading-[1.15rem] prose-pre:text-[0.9rem]
                prose-strong:text-slate-100
                prose-ol:font-serif
                prose-ul:font-serif
                prose-a:text-myblue
                prose-a:border-b-myblue
                hover:prose-a:border-b-sky-600
                hover:prose-a:text-sky-600
                prose-code:prose-pre:px-0 prose-code:prose-pre:py-0
                prose-code:bg-[#414242] prose-code:px-1 prose-code:py-0.5 prose-code:rounded
                ">
                
                <div class="relative pb-[56.25%] h-0 overflow-hidden w-full">
                    <iframe class="absolute w-full h-full top-0 left-0 border-0" src="https://www.youtube.com/embed/1ad5dq0Wi-c">
                    </iframe>
                </div>
                

                <div class="font-bold my-1 text-white text-sm md:hidden">Published January 9, 2022
                </div>
                
                <p>Here we will make a windows Docker image which uses <a href="https://hub.docker.com/_/microsoft-windows-nanoserver" target="_blank">Windows Nano Server</a> as the base image</p>

<p>This is great for deploying your <a href="https://dotnet.microsoft.com/en-us/download/dotnet" target="_blank">.Net</a> apps on Docker</p>

<blockquote>
<p><a href="https://github.com/coolstercodes/Tutorials/tree/main/tutorials/docker-nanoserver-base-image-windows" target="_blank">Source code</a></p>
</blockquote>

<h2 id="prereqs" class="link"><a href="#prereqs">Prereqs</a></h2>

<ul>
<li><a href="https://www.docker.com/products/docker-desktop" target="_blank">Docker Desktop</a> installed on Windows Enterprise, Pro or Educational machine

<ul>
<li>Windows Home edition will not work since <a href="https://docs.microsoft.com/en-us/virtualization/hyper-v-on-windows/quick-start/enable-hyper-v" target="_blank">Hyper-V</a> needs to be enabled and Windows Home just doesn’t offer it</li>
</ul></li>
<li><a href="https://docs.microsoft.com/en-us/virtualization/hyper-v-on-windows/quick-start/enable-hyper-v" target="_blank">Hyper-V</a> feature enabled</li>
<li><a href="https://docs.microsoft.com/en-us/visualstudio/install/install-visual-studio?view=vs-2022" target="_blank">Visual Studio</a>

<ul>
<li>Or the .Net 6.0 SDK</li>
</ul></li>
<li>A <a href="https://dotnet.microsoft.com/en-us/download/dotnet" target="_blank">.Net</a> app (.Net versions 3.1, 5.x and 6.x)

<ul>
<li><a href="https://dotnet.microsoft.com/en-us/download/dotnet-framework" target="_blank">.Net Framework</a> apps won’t work on Nano Server (.Net versions 4.x)</li>
</ul></li>
</ul>

<h2 id="create-the-app" class="link"><a href="#create-the-app">Create the app</a></h2>

<p>First we need to create a sample .Net app</p>

<pre><code class="language-shell">dotnet new console -o App -n DotNet.Docker
</code></pre>

<p>This creates a new folder App with a very simple <a href="https://docs.microsoft.com/en-us/visualstudio/get-started/csharp/tutorial-console?view=vs-2022" target="_blank">console app</a> in it using .Net version 6.0</p>

<h2 id="edit-the-app" class="link"><a href="#edit-the-app">Edit the app</a></h2>

<p>We’re just going to edit it slightly to loop after saying “Hello world!”</p>

<pre><code class="language-c#">Console.WriteLine(&quot;Hello, World!&quot;);

for (int i = 0; i &lt; 500; i++)
{
    Console.WriteLine(&quot;Sleep for 2 seconds.&quot;);
    Thread.Sleep(2000);
}
</code></pre>

<h2 id="build-the-app" class="link"><a href="#build-the-app">Build the app</a></h2>

<p>We’ll build the app and copy the binaries into the container image</p>

<p>Navigate to the App directory and run:</p>

<pre><code class="language-shell">dotnet publish -c Release
</code></pre>

<p>This will create the precious binary files at <code>App/bin/Release/net6.0/publish</code></p>

<h2 id="create-dockerfile" class="link"><a href="#create-dockerfile">Create Dockerfile</a></h2>

<p>Here is the final Dockerfile, though I will explain each part below</p>

<pre><code class="language-docker">FROM mcr.microsoft.com/powershell:lts-nanoserver-1909

# Run as admin
USER ContainerAdministrator

# Make default shell powershell
SHELL [&quot;pwsh&quot;, &quot;-command&quot;]

# Dotnet 6.0.101 install
WORKDIR Users\\Example\\dotnetinstall\\6.0.101
RUN Invoke-WebRequest -OutFile dotnet-install.ps1 -URI https://dotnet.microsoft.com/download/dotnet/scripts/v1/dotnet-install.ps1
RUN .\dotnet-install.ps1 -Version 6.0.101 -InstallDir &quot;&quot;&quot;C:\\Users\\Example\\\\dotnetinstall\\6.0.101&quot;&quot;&quot;

# Copy the application binaries into the docker image
COPY App/bin/Release/net6.0/publish/ C:\\Users\\Example\\App

# Run the application binaries as the main container program
WORKDIR C:\\Users\\Example\\App
ENTRYPOINT [&quot;C:\\Users\\Example\\dotnetinstall\\6.0.101\\dotnet.exe&quot;, &quot;C:\\Users\\Example\\App\\DotNet.Docker.dll&quot;]
</code></pre>

<p><code>FROM mcr.microsoft.com/powershell:lts-nanoserver-1909</code> is to specify which Docker image we want to use as the base image. This <code>powershell:lts-nanoserver-1909</code> image is from <a href="https://hub.docker.com/_/microsoft-powershell" target="_blank">Microsoft’s powershell docker hub</a>. It comes with really lightweight version of the Windows OS called <a href="https://hub.docker.com/_/microsoft-windows-nanoserver" target="_blank">Nano server</a> which is great for containers, since you generally want to keep container images small.</p>

<p>This <code>powershell:lts-nanoserver-1909</code> image also comes with a new version of Powershell 7 called <code>pwsh</code> (read more <a href="https://docs.microsoft.com/en-us/powershell/scripting/whats-new/what-s-new-in-powershell-70?view=powershell-7.2" target="_blank">here</a>).</p>

<p><code>pwsh</code> is an open-source cross-platform version of Powershell. There are a few extra steps to get it to do all of what previous versions of Powershell could do which I will cover in a different article.</p>

<p><code>USER ContainerAdministrator</code> is to make the commands run as admin, since this is not set by default in Windows (Linux it is default). Basically without this command, any subsequent steps can’t access files downloaded/copied from previous steps.</p>

<p><code>SHELL [&quot;pwsh&quot;, &quot;-command&quot;]</code> is to make the commands that happen in the RUN sections executed through pwsh instead of the default cmd</p>

<p><code>WORKDIR Users\\Example\\dotnetinstall\\6.0.101</code> is to make a folder in the container image with the given path to use as a workspace. It also navigates to this directory for any subsequent commands.</p>

<p><code>RUN Invoke-WebRequest -OutFile dotnet-install.ps1 -URI https://dotnet.microsoft.com/download/dotnet/scripts/v1/dotnet-install.ps1</code> is to download a <a href="https://docs.microsoft.com/en-us/dotnet/core/tools/dotnet-install-script" target="_blank">dotnet install script</a> and then the following command is to install the dotnet runtime into the <code>C:\\Users\\Example\\\\dotnetinstall\\6.0.101</code> directory. We later use this runtime package to actually run our .Net app.</p>

<p>Instead of manually installing via this <code>dotnet-install.ps1</code> script, you could alternatively use <code>mcr.microsoft.com/dotnet/aspnet:6.0</code> (read more <a href="https://hub.docker.com/_/microsoft-dotnet-aspnet" target="_blank">here</a>) as the base image, but I personally find it hard to debug since it doesn’t come with <code>cmd</code>, <code>powershell</code>, <code>pwsh</code>, or any sort of shell.</p>

<p><code>COPY App/bin/Release/net6.0/publish/ C:\\Users\\Example\\App</code> is to copy the folder with the binaries into the container image.</p>

<p><code>WORKDIR C:\\Users\\Example\\App</code> is to create a working directory and finally <code>ENTRYPOINT [&quot;C:\\Users\\Example\\dotnetinstall\\6.0.101\\dotnet.exe&quot;, &quot;C:\\Users\\Example\\App\\DotNet.Docker.dll&quot;]</code> is to tell Docker to invoke the dotnet runtime which we installed as the main entrypoint of the container, and to pass it the DotNet.Docker.dll file as an argument. This will essentially start our app and print <code>&quot;Hello world!&quot;</code> and then loop.</p>

<h2 id="build-the-docker-image" class="link"><a href="#build-the-docker-image">Build the Docker image</a></h2>

<pre><code class="language-shell">docker build -t dotnetexample:v1.0.0 -f .\Dockerfile .
</code></pre>

<p>Run this command from just outside the App directory. Ensure the Dockerfile is also just outside the App directory.</p>

<p>Remember: you have to enable the Hyper-v feature for Windows 10 Enterprise, Pro or Educational. Windows 10 home will not work.</p>

<p>You must also ensure that Docker Desktop is using Windows Containers:</p>

<figure class="text-center">
  <a data-fancybox="gallery" href="/content/images/docker-nanoserver-base-image-windows/windows-containers.png" data-caption="Ensure Docker Desktop is using Windows Containers">
    <img src="/content/images/docker-nanoserver-base-image-windows/windows-containers.png" />
  </a>
  <figcaption>Ensure Docker Desktop is using Windows Containers</figcaption>
</figure>

<p>If you need quick access to a Windows 10 Enterprise machine, you can create one in <a href="https://azure.microsoft.com/en-us/features/azure-portal/" target="_blank">Azure Portal</a></p>

<figure class="text-center">
  <a data-fancybox="gallery" href="/content/images/docker-nanoserver-base-image-windows/create-windows-10-VM.jpg" data-caption="Creating a Windows Enterprise machine in Azure Portal if need be">
    <img src="/content/images/docker-nanoserver-base-image-windows/create-windows-10-VM.jpg" />
  </a>
  <figcaption>Creating a Windows Enterprise machine in Azure Portal if need be</figcaption>
</figure>

<h2 id="run-image" class="link"><a href="#run-image">Run image</a></h2>

<pre><code class="language-shell">docker run dotnetexample:v1.0.0
</code></pre>

<figure class="text-center">
  <a data-fancybox="gallery" href="/content/images/docker-nanoserver-base-image-windows/docker-run.png" data-caption="Run the docker image!">
    <img src="/content/images/docker-nanoserver-base-image-windows/docker-run.png" />
  </a>
  <figcaption>Run the docker image!</figcaption>
</figure>

<p>You can also interactively run powershell commands in the container with:</p>

<pre><code class="language-shell">docker run -it --entrypoint pwsh dotnetexample:v1.0.0
</code></pre>

<figure class="text-center">
  <a data-fancybox="gallery" href="/content/images/docker-nanoserver-base-image-windows/exec.png" data-caption="Interactively run powershell commands in container image">
    <img src="/content/images/docker-nanoserver-base-image-windows/exec.png" />
  </a>
  <figcaption>Interactively run powershell commands in container image</figcaption>
</figure>

<p>You&rsquo;ve done it!</p>

            </div>
            
            <div class="pt-4">
                <div class="flex items-center py-1">
                    <div class="font-bold mb-0.5 text-white mr-0.5">Tags: </div>
                    
                    <a class="italic bg-gray-700 rounded-md px-[5px] py-[2px] text-myblue text-sm hover:text-sky-600 mx-0.5"
                        href="/tags/development">#Development</a>
                    
                    <a class="italic bg-gray-700 rounded-md px-[5px] py-[2px] text-myblue text-sm hover:text-sky-600 mx-0.5"
                        href="/tags/docker">#Docker</a>
                    
                    <a class="italic bg-gray-700 rounded-md px-[5px] py-[2px] text-myblue text-sm hover:text-sky-600 mx-0.5"
                        href="/tags/windows">#Windows</a>
                    
                </div>
            </div>
            
        </div>
        
            <div class="basis-[190px] border-l flex-grow-0 flex-shrink-0 hidden xl:block ">
                
                
                <div class="
                    mb-3
                    pl-3
                    pb-5

                    prose prose-sm
                    prose-li:my-2

                    prose-ol:prose-li:list-[lower-alpha] prose-ol:prose-li:my-2
                    prose-a:prose-li:prose-li:font-normal prose-li:prose-li:my-1 prose-li:prose-li:text-[0.65rem] hover:prose-a:prose-li:text-sky-600 hover:prose-a:prose-li:border-b-sky-600

                    prose-ol:prose-li:prose-li:list-[lower-roman]
                    prose-li:prose-li:prose-li:text-[0.6rem]

                    sticky top-5
                    text-xs
                ">
                    <ol><li><a href="#prereqs">Prereqs</a></li><li><a href="#create-the-app">Create the app</a></li><li><a href="#edit-the-app">Edit the app</a></li><li><a href="#build-the-app">Build the app</a></li><li><a href="#create-dockerfile">Create Dockerfile</a></li><li><a href="#build-the-docker-image">Build the Docker image</a></li><li><a href="#run-image">Run image</a></li></ol>
                </div>
            </div>
        
    </div>
</div>





<div class="border-t pb-8 p-8 w-vp ">
    <div class="container max-w-[650px] mx-auto">
        <div class="hyphens-auto
            italic
            max-w-none
            prose prose-sm
            prose-a:border-b-myblue prose-a:font-sans
            hover:prose-a:text-sky-600
            prose-p:font-serif
            ">
            <p>
                Thanks for reading! :)
            </p>
        </div>
    </div>
</div>
</div>
<div id="search-results" class="hidden text-white p-4"></div>
<div id="dummy" class="hidden text-gray-400 pb-2 pt-2 pb-1 text-myblue text-xl border-b-[1px] border-b-myblue font-semibold hover:border-b-sky-600 hover:text-sky-600 text-green-500 text-sm pb-1 text-gray-200 text-sm text-center bg-gray-600 rounded-md px-[5px] py-[2px] ml-1 font-extrabold pb-1 py-1 relative absolute w-full h-full pb-[56.25%] h-0 overflow-hidden top-0 left-0 border-0 bg-myblue mb-3 mr-4"></div>

    <script type="module">


import { codeToHtml } from 'https://esm.sh/shiki@1.0.0'



const htmlEscapes = new Map([
    ['&amp;', '&'],
    ['&lt;', '<'],
    ['&gt;', '>'],
]);

function unescapeHTMLEntities(str) {
    for (const [escaped, unescaped] of htmlEscapes) {
        str = str.replaceAll(escaped, unescaped)
    }
    return str
}

await Promise.all(Array.from(document.querySelectorAll('pre code')).map((codeBlock) => {
    const classNames = codeBlock.getAttribute("class");
    if (classNames == null) {
        return
    }

    let language = null;
    for (const className of classNames.split(" ")) {
        const [languageToken, ...rest] = className.split("-")
        if (languageToken == "language") {
            
            
            
            language = rest.join("-")
            break
        }
    }

    if (language == null) {
        return
    }

    return (async () => {
        const code = unescapeHTMLEntities(codeBlock.innerHTML)

        
        
        codeBlock.parentElement.outerHTML = 
            await codeToHtml(code, {
                lang: language,
                themes: {
                    dark: 'github-dark',
                    light: 'github-dark'
                }
            })
    })()
}))

</script>

    <script src="/content/javascripts/fancybox.umd.js"></script>
<script>
    Fancybox.bind('[data-fancybox]', {
        
    });
</script>

    <script src="/content/javascripts/buttons.js"></script>

    <script type="module" src="/content/javascripts/docfx.min.js"></script>
<script type="module" src="/content/javascripts/search-worker.min.js"></script>


</body>

</html>
